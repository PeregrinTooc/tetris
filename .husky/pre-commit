echo "Running unit tests before commit..."
npm run test:unit

if [ $? -ne 0 ]; then
	echo "Unit tests failed. Commit aborted."
	exit 1
fi

echo "Unit tests passed. Proceeding with commit."

# Get list of staged files before formatting
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

npm run format

# Re-stage only the files that were originally staged
if [ -n "$STAGED_FILES" ]; then
	echo "Re-staging formatted files..."
	echo "$STAGED_FILES" | xargs git add
fi

echo "Pre-commit checks complete."
